<div class="tab-container">
  <div class="tab-header">
    <button
      class="tab-button"
      [class.active]="activeTab === 'tram'"
      (click)="setActiveTab('tram')">
      <img class="tab-icon" src="assets/icons/tram.svg" alt="Tram">
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'bus'"
      (click)="setActiveTab('bus')">
      <img class="tab-icon" src="assets/icons/bus.svg" alt="Bus">
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'map'"
      (click)="setActiveTab('map')">
      <img class="tab-icon" src="assets/icons/map.svg" alt="Map">
    </button>
  </div>

  <div class="tab-content">
    <div class="tab-panel" [class.active]="activeTab === 'tram' || activeTab === 'bus'">
      <div class="stops-container">
        <div class="loading-overlay" *ngIf="isLoading">
          <div class="loading-spinner"></div>
          <p>Suche nächste Haltestellen...</p>
        </div>

        <div class="error-overlay" *ngIf="error && !isLoading">
          <div class="error-content">
            <div class="error-icon">🚏</div>
            <p>{{ error }}</p>
            <button class="retry-button" (click)="retryLoadStops()">Erneut versuchen</button>
          </div>
        </div>

        <div class="stops-list" *ngIf="!isLoading && !error && nearestStops.length > 0">
          <div class="stop-item" *ngFor="let stop of nearestStops; let i = index"
               [class.expanded]="stop.expanded"
               (click)="toggleStopExpansion(i)">
            <div class="stop-info">
              <div class="stop-header">
                <div class="stop-main-info">
                  <h3 class="stop-name">
                    {{ stop.stop_name }} {{ stop.stop_num }} -
                    <span class="stop-distance">{{ (stop.distance! * 1000) | number:'1.0-0' }}m entfernt</span>
                  </h3>
                </div>
                <div class="expand-icon" [class.rotated]="stop.expanded">▼</div>
              </div>

              <div class="stop-directions" *ngIf="!stop.loadingDirections && stop.directions && stop.directions.length > 0">
                <p class="directions-label">Richtungen:</p>
                <div class="directions-list">
                  <span class="direction-item" *ngFor="let direction of stop.directions">{{ direction }}</span>
                </div>
              </div>
              <div class="directions-loading" *ngIf="stop.loadingDirections">
                <div class="directions-spinner"></div>
                <span class="directions-loading-text">Lade Richtungen...</span>
              </div>

              <div class="departures-section" *ngIf="stop.expanded">
                <div class="departures-loading" *ngIf="stop.loadingDepartures">
                  <div class="departures-spinner"></div>
                  <span class="departures-loading-text">Lade Abfahrten...</span>
                </div>

                <div class="departures-list" *ngIf="!stop.loadingDepartures && stop.departures && stop.departures.length > 0">
                  <h4 class="departures-title">Abfahrten:</h4>
                  <div class="departure-item" *ngFor="let departure of stop.departures">
                    <div class="departure-line">{{ departure.line }}</div>
                    <div class="departure-direction">{{ departure.direction }}</div>
                    <div class="departure-vehicle clickable"
                         (click)="copyToClipboard(departure.vehicleNumber, $event)"
                         title="Klicken zum Kopieren">
                      {{ departure.vehicleNumber }}
                    </div>
                    <div class="departure-time">{{ departure.minutesUntilDeparture }} min</div>
                  </div>
                </div>

                <div class="no-departures" *ngIf="!stop.loadingDepartures && (!stop.departures || stop.departures.length === 0)">
                  <p>Keine Abfahrten verfügbar</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-panel" [class.active]="activeTab === 'map'">
      <app-map></app-map>
    </div>
  </div>
</div>

<router-outlet/>
